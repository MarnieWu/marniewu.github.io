{"title":"Rust Test","uid":"acc0e87b34830b962966d84f538705e6","slug":"rust-test","date":"2025-01-27T02:12:05.000Z","updated":"2025-01-27T10:59:10.090Z","comments":true,"path":"api/articles/rust-test.json","keywords":"","cover":[],"content":"<h2 id=\"Unit-Test\"><a href=\"#Unit-Test\" class=\"headerlink\" title=\"Unit Test\"></a>Unit Test</h2><p>å•å…ƒæµ‹è¯•</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(left: <span class=\"type\">u64</span>, right: <span class=\"type\">u64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u64</span> &#123;</span><br><span class=\"line\">    left + right</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#[cfg(test)]</span></span><br><span class=\"line\"><span class=\"keyword\">mod</span> tests &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¯¼å…¥å½“å‰åŒ…æ‰€æœ‰çš„å†…å®¹</span></span><br><span class=\"line\">    <span class=\"keyword\">use</span> super::*;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#[test]</span> <span class=\"comment\">// å±æ€§å®ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå•å…ƒæµ‹è¯•</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">it_works</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">2</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">assert_eq!</span>(result, <span class=\"number\">4</span>, <span class=\"string\">&quot;result is &#123;&#125;&quot;</span>, result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#[test]</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">feature_sum2</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">2</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">assert_eq!</span>(result, <span class=\"number\">4</span>, <span class=\"string\">&quot;âœ¨âœ¨âœ¨ result is &#123;&#125;&quot;</span>, result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#[test]</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">feature</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), ()&gt; &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#[test]</span></span><br><span class=\"line\">    <span class=\"comment\">// ğŸ“Œ æ˜¾å¼çš„æ ‡è®°ä¸‹é¢çš„å•æµ‹æ˜¯ä¼šå‘ç”Ÿpanicçš„ï¼Œpanicä¸ä¼šå½±å“å•æµ‹é€šè¿‡</span></span><br><span class=\"line\">    <span class=\"comment\">// expectedè®¾ç½®æœŸå¾…çš„panic messageï¼Œè‹¥ä¸åŒ¹é…åˆ™å•æµ‹å¤±è´¥</span></span><br><span class=\"line\">    <span class=\"meta\">#[should_panic(expected = <span class=\"string\">&quot;error2&quot;</span>)]</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">test_todo</span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;error2&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#[test]</span></span><br><span class=\"line\">    <span class=\"meta\">#[ignore]</span> <span class=\"comment\">// æ˜¾å¼çš„å¿½ç•¥æŸä¸ªå•å…ƒæµ‹è¯•</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">test_3</span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">unimplemented!</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Integration-Test\"><a href=\"#Integration-Test\" class=\"headerlink\" title=\"Integration Test\"></a>Integration Test</h2><p>é›†æˆæµ‹è¯•</p>\n<p>åœ¨ä¸ src ç›®å½•åŒçº§ä¸‹åˆ›å»º tests ç›®å½•ï¼Œå­˜æ”¾é›†æˆæµ‹è¯•ï¼ˆintegration testï¼‰çš„æ–‡ä»¶ã€‚test ç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªå•ç‹¬çš„ crateï¼Œcrate åå°±æ˜¯æ–‡ä»¶åã€‚è¿è¡Œå‘½ä»¤ <code>cargo test</code> ä¼šæ‰§è¡Œå½“å‰ package ä¸‹æ‰€æœ‰çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚</p>\n<h2 id=\"cargo-test\"><a href=\"#cargo-test\" class=\"headerlink\" title=\"cargo test\"></a><code>cargo test</code></h2><p><code>cargo test --test [TEST_CRATE_NAME]</code> ç”¨äºæ‰§è¡Œå•ä¸ªé›†æˆæµ‹è¯•æ–‡ä»¶ã€‚</p>\n<p><code>cargo test [TESTNAME]</code> ç”¨äºæ‰§è¡ŒæŸä¸ªå•å…ƒæµ‹è¯•ï¼ˆæä¾›å‡½æ•°åï¼‰ã€‚</p>\n<p><code>cargo test -- --ignored</code> ç”¨äºæ‰§è¡Œæ‰€æœ‰æ ‡è®° <code>ignore</code> çš„å•å…ƒæµ‹è¯•ã€‚</p>\n<p><code>cargo test --doc</code> ç”¨äºæ‰§è¡Œæ‰€æœ‰æ–‡æ¡£æµ‹è¯•ã€‚</p>\n<p><code>cargo test --examples [TESTNAME]</code> ç”¨äºæ‰§è¡Œæ‰€æœ‰&#x2F;æŒ‡å®š Examples æµ‹è¯•ã€‚</p>\n<p>åœ¨é›†æˆæµ‹è¯•ç›®å½•ä¸‹ï¼Œå¦‚æœéœ€è¦æŠ½å…¬å…±æ¨¡å—ï¼Œéœ€è¦å•ç‹¬å†å»ºä¸€ä¸ªç›®å½•å¦‚ commonï¼Œåœ¨æ–°å»ºç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ã€‚</p>\n<h2 id=\"Doc-Tests\"><a href=\"#Doc-Tests\" class=\"headerlink\" title=\"Doc Tests\"></a>Doc Tests</h2><p>æ–‡æ¡£æµ‹è¯•</p>\n<p><code>///</code> ä¸ºå‡½æ•°æ ‡æ³¨æ–‡æ¡£æµ‹è¯•çš„æ³¨é‡Šã€‚</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// Add to number</span></span><br><span class=\"line\"><span class=\"comment\">/// # Examples</span></span><br><span class=\"line\"><span class=\"comment\">/// ```rust</span></span><br><span class=\"line\"><span class=\"comment\">/// assert_eq!(rust_lib::add(1,1),2)</span></span><br><span class=\"line\"><span class=\"comment\">/// ```</span></span><br><span class=\"line\"><span class=\"comment\">/// # Panic</span></span><br><span class=\"line\"><span class=\"comment\">/// # Errors</span></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(left: <span class=\"type\">u64</span>, right: <span class=\"type\">u64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u64</span> &#123;</span><br><span class=\"line\">    left + right</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// rust_lib ä¸ºå½“å‰ cargo é…ç½®æ–‡ä»¶ä¸‹çš„ package nameï¼Œéœ€è¦æŠŠ â€œ-â€ è½¬æ¢æˆ â€œ_â€</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><code>//!</code> ä¸ºæ¨¡å—æ ‡æ³¨æ–‡æ¡£æµ‹è¯•çš„æ³¨é‡Šï¼Œæ¨¡å—æ³¨é‡Šåªèƒ½å†™åœ¨æ–‡ä»¶å¤´éƒ¨ã€‚<strong>é€šå¸¸æ˜¯ç”¨æ¥å†™æ¨¡å—è¯´æ˜çš„</strong></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//! #utils</span></span><br><span class=\"line\"><span class=\"comment\">//! A module helper you</span></span><br><span class=\"line\"><span class=\"comment\">//! ```rust</span></span><br><span class=\"line\"><span class=\"comment\">//! assert_eq!(rust_lib::utils::sum(1,1),2)</span></span><br><span class=\"line\"><span class=\"comment\">//! ```</span></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">mod</span> utils &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">sum</span>(a: <span class=\"type\">u8</span>, b: <span class=\"type\">u8</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u8</span> &#123;</span><br><span class=\"line\">        a + b</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"Benches-unstable-TODO\"><a href=\"#Benches-unstable-TODO\" class=\"headerlink\" title=\"Benches [unstable __ TODO]\"></a>Benches [unstable __ TODO]</h2><p>åŸºå‡†æµ‹è¯•ï¼ˆæ€§èƒ½æµ‹è¯•ï¼‰**unstable **çŠ¶æ€</p>\n<h2 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h2><p>å½“æˆ‘ä»¬éœ€è¦ä¸ºå½“å‰ rust ä»£ç æä¾›ä¸€äº› demo æ—¶ï¼Œå¯ä»¥ä¸ <code>src</code> åŒçº§åˆ›å»º <code>examples</code> ç›®å½•ï¼Œä¸‹é¢å¯ä»¥æ”¾å¤šä¸ª demo æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶é‡Œå¯ä»¥æä¾›ä¸€äº›è‡ªå·±çš„å•å…ƒæµ‹è¯•ä»£ç ã€‚</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// examples/a.rs</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">use</span> rust_lib::add;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">sum</span> = <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(sum, <span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#[test]</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">feature_a</span>() &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#[test]</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">feature_b</span>() &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><code>cargo test --examples a</code> ç”¨äºæ‰§è¡Œ a æ–‡ä»¶ä¸‹çš„æ‰€æœ‰å•å…ƒæµ‹è¯•ã€‚</p>\n<p><code>cargo test --examples feature_a</code> ç”¨äºæ‰§è¡Œ <code>examples</code> ç›®å½•ä¸‹æœ€åä¸€ä¸ªåä¸º <code>feature_a</code> çš„å•å…ƒæµ‹è¯•ã€‚</p>\n<h2 id=\"cfg-test\"><a href=\"#cfg-test\" class=\"headerlink\" title=\"#[cfg(test)]\"></a><code>#[cfg(test)]</code></h2><p>å±æ€§å®ï¼Œç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨è¿™éƒ¨åˆ†ä»£ç æ˜¯æµ‹è¯•ä»£ç ï¼Œæµ‹è¯•ä»£ç æ˜¯åªæœ‰è¿è¡Œ <code>cargo test</code> æ‰ä¼šè¢«æ‰§è¡Œçš„ä»£ç ï¼Œ<code>cargo build</code> æ—¶ä¸ä¼šæ‰§è¡Œã€‚</p>\n<h2 id=\"Engineering-Spec-å·¥ç¨‹è§„èŒƒ\"><a href=\"#Engineering-Spec-å·¥ç¨‹è§„èŒƒ\" class=\"headerlink\" title=\"Engineering Spec å·¥ç¨‹è§„èŒƒ\"></a>Engineering Spec å·¥ç¨‹è§„èŒƒ</h2><p><img src=\"/../images/rust-test/image-20250127154910967.png\" alt=\"image-20250127154910967\"></p>\n<h2 id=\"ç»ƒä¹ \"><a href=\"#ç»ƒä¹ \" class=\"headerlink\" title=\"ç»ƒä¹ \"></a>ç»ƒä¹ </h2><p><img src=\"/../images/rust-test/image-20250127155136842.png\" alt=\"image-20250127155136842\"></p>\n<h3 id=\"é…ç½®-github\"><a href=\"#é…ç½®-github\" class=\"headerlink\" title=\"é…ç½® github\"></a>é…ç½® github</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Github Actions å‚è€ƒ:  <a href=\"https://docs.github.com/en/actions/writing-workflows/using-workflow-templates\">https://docs.github.com/en/actions/writing-workflows/using-workflow-templates</a></p></blockquote>\n<p>åœ¨ github ä¸Šæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œå°†æœ¬åœ°ä»“åº“ä¸ä¹‹å…³è”ï¼Œç‚¹å‡» Actions é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿ï¼ŒæŒ‰ç…§ publish crate æ­¥éª¤å¯¹æ¨¡æ¿è¿›è¡Œä¿®æ”¹ã€‚</p>\n<h3 id=\"Puiblishing-on-crates-io\"><a href=\"#Puiblishing-on-crates-io\" class=\"headerlink\" title=\"Puiblishing on crates.io\"></a>Puiblishing on crates.io</h3><p><strong>Before your first publish: Need Login!!</strong></p>\n<p>éœ€è¦ç™»å½•æ‰èƒ½å¤Ÿå‘å¸ƒåˆ°å®˜æ–¹å¸‚åœºã€‚æˆ‘ä»¬è¿™é‡Œç”¨ Github Actions è‡ªåŠ¨å‘å¸ƒçš„è¯ï¼Œå°±éœ€è¦å» crates.io ä¸Šæ‹¿ä¸€ä¸ª tokenï¼ˆç™»å½•å‡­è¯ï¼‰å­˜åˆ° github ä»“åº“çš„ settings ä¸­ï¼Œç„¶ååœ¨ ci è„šæœ¬é‡Œå¯ä»¥ä½¿ç”¨ã€‚</p>\n<p>crates.io é¦–æ¬¡ç”¨ github ç™»å½•åï¼Œä¼šè‡ªåŠ¨å¾€å¯¹åº”é‚®ç®±å‘é€éªŒè¯é‚®ä»¶ï¼Œåªæœ‰é€šè¿‡é‚®ç®±æ ¡éªŒæ‰èƒ½ç”¨è„šæœ¬è¿›è¡Œå‘å¸ƒã€‚éªŒè¯å®Œæˆå <a href=\"https://crates.io/settings/tokens\">https://crates.io/settings/tokens</a> åœ¨è¿™ä¸ªé¡µé¢ç”Ÿæˆ tokenã€‚</p>\n<p><img src=\"/../images/rust-test/image-20250127181457703.png\" alt=\"image-20250127181457703\"></p>\n<p>å°†ç”Ÿæˆçš„ token å¤åˆ¶ï¼Œå†åˆ° Github ä»“åº“ä¸‹ &gt; Settings &gt; Secrets and variables &gt; Actions é€‰æ‹© New repository secretï¼Œå°† token å­˜å…¥ã€‚</p>\n<p><img src=\"/../images/rust-test/image-20250127181823573.png\" alt=\"image-20250127181823573\"></p>\n<p><img src=\"/../images/rust-test/image-20250127181928716.png\" alt=\"image-20250127181928716\"></p>\n<p>è¿™é‡Œå¡«å†™çš„ secrets name å°±æ˜¯ä¹‹ååœ¨ ci æ–‡ä»¶é‡Œä¼šç”¨åˆ°çš„å˜é‡åã€‚</p>\n<h3 id=\"Publish-a-crate\"><a href=\"#Publish-a-crate\" class=\"headerlink\" title=\"Publish a crate\"></a>Publish a crate</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>æ–‡æ¡£å‚è€ƒï¼š<a href=\"https://doc.rust-lang.org/cargo/reference/publishing.html#packaging-a-crate\">https://doc.rust-lang.org/cargo/reference/publishing.html#packaging-a-crate</a></p></blockquote>\n<p><strong>Keep in mind:</strong> </p>\n<p>crate ååœ¨å¸‚åœºä¸Šä¸èƒ½é‡å¤ï¼Œå·²ç»å­˜åœ¨çš„åŒ…åå‘å¸ƒä¼šå¤±è´¥ã€‚åŒ…åæŒ‡çš„æ˜¯ <code>Cargo.toml</code> é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ package nameã€‚</p>\n<p><strong>Make sure you have filled the following fields:</strong></p>\n<p><img src=\"/../images/rust-test/image-20250127171346131.png\" alt=\"image-20250127171346131\"></p>\n<p>è¡¥å……ç›¸å…³å­—æ®µï¼Œåˆ›å»º <code>README.md</code></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Cargo.toml</span></span><br><span class=\"line\">[package]</span><br><span class=\"line\">name = <span class=\"string\">&quot;publish-crate-with-github-actions-demo&quot;</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\">edition = <span class=\"string\">&quot;2021&quot;</span></span><br><span class=\"line\">license = <span class=\"string\">&quot;MIT&quot;</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;This package is used for test publish a crate with github actions&quot;</span></span><br><span class=\"line\">homepage = <span class=\"string\">&quot;https://marniewu.github.io/post/rust-test&quot;</span></span><br><span class=\"line\">repository = <span class=\"string\">&quot;https://github.com/MarnieWu/publish-crate-demo&quot;</span></span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[dependencies]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// README.md</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\"># Publish a crate with Github Actions</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Packaging-a-crate\"><a href=\"#Packaging-a-crate\" class=\"headerlink\" title=\"Packaging a crate\"></a>Packaging a crate</h3><p>æ‰“åŒ…</p>\n<p><code>cargo publish</code> åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š</p>\n<ol>\n<li>å¯¹ä½ çš„ package è¿›è¡Œä¸€äº›æ ¡éªŒæ£€æŸ¥ã€‚</li>\n<li>å‹ç¼©ä½ çš„æºä»£ç ä¸ºä¸€ä¸ª <code>.crate</code> æ–‡ä»¶ã€‚</li>\n<li>æå– <code>.crate</code> æ–‡ä»¶åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶ç›®å½•ä¸‹å¹¶éªŒè¯å®ƒæ˜¯å¦å¯ä»¥ç¼–è¯‘ã€‚</li>\n<li>ä¸Šä¼  <code>.crate</code> æ–‡ä»¶è‡³ <code>crate.io</code>ã€‚</li>\n<li>åœ¨æ·»åŠ ä¹‹å‰ï¼Œæ³¨å†Œè¡¨ä¼šå¯¹ä¸Šä¼ çš„åŒ…åšä¸€äº›é¢å¤–çš„æ£€æŸ¥ã€‚</li>\n</ol>\n<p>æ³¨å†Œè¡¨ï¼šæŒ‡çš„æ˜¯å¹³å°æä¾›çš„ä¸€ä¸ªå¯è¢«ä¸‹è½½çš„åŒ…çš„æ¸…å• listï¼Œå®ƒç»´æŠ¤äº†æ‰€æœ‰å¹³å°ä¸Šå¯ç”¨çš„åŒ…ä»¥åŠå®ƒä»¬çš„ç‰ˆæœ¬ã€ä¾èµ–å’Œæè¿°ç­‰ç­‰ä¿¡æ¯ã€‚</p>\n<p>è¿è¡Œ <code>cargo publish --dry-run</code>  åœ¨å‘å¸ƒå‰æ£€æŸ¥æ˜¯å¦å­˜åœ¨ warnings å’Œ errorsï¼Œå¦‚æœæœ‰é…ç½® Cargo é•œåƒçš„éœ€è¦æ³¨é‡Šæ‰ç”¨å®˜æ–¹çš„æºæ‰èƒ½å‘å¸ƒã€‚</p>\n<p><img src=\"/../images/rust-test/image-20250127180210243.png\" alt=\"image-20250127180210243\"></p>\n<p>æŒ‰æç¤ºåº”è¯¥æ˜¯æ–‡ä»¶æœªæäº¤ï¼Œæˆ‘ä»¬å…ˆæäº¤ä¸‹å¹¶åŒæ­¥åˆ° githubã€‚å†æ¬¡è¿è¡Œï¼Œé€šè¿‡æ£€æŸ¥ âœ…ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬æŠŠå‘½ä»¤è¡Œé…ç½®åˆ° ci æ–‡ä»¶ä¸­ï¼Œè®©å®ƒé€šè¿‡ Github Actions çš„ CI ç»“åˆï¼Œè¿›è¡Œè‡ªåŠ¨å‘å¸ƒã€‚</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># This is a basic workflow to help you get started with Actions</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">PUBLISHING</span> <span class=\"string\">ON</span> <span class=\"string\">crates.io</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Controls when the workflow will run</span></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"comment\"># Triggers the workflow on push or pull request events but only for the &quot;main&quot; branch</span></span><br><span class=\"line\">  <span class=\"attr\">push:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span> [<span class=\"string\">&quot;main&quot;</span>]</span><br><span class=\"line\">  <span class=\"attr\">pull_request:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span> [<span class=\"string\">&quot;main&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Allows you to run this workflow manually from the Actions tab</span></span><br><span class=\"line\">  <span class=\"attr\">workflow_dispatch:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"comment\"># This workflow contains a single job called &quot;publish&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">publish:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">Publish</span></span><br><span class=\"line\">    <span class=\"comment\"># The type of runner that the job will run on</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span></span><br><span class=\"line\">      <span class=\"comment\"># âœ¨ è¿™é‡Œæ˜¯æˆ‘ä»¬å‰é¢åœ¨ä»“åº“è®¾ç½®çš„ token</span></span><br><span class=\"line\">      <span class=\"attr\">CRATES_TOKEN:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.CRATES_TOKEN</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">RUST_CHANNEL:</span> <span class=\"string\">&quot;stable&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># Steps represent a sequence of tasks that will be executed as part of the job</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">uses:</span> <span class=\"string\">actions/checkout@v4</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># Install Rust toolchain</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Install</span> <span class=\"string\">Rust</span> <span class=\"string\">toolchain</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          rustup update --no-self-update $&#123;&#123; env.RUST_CHANNEL &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          rustup component add --toolchain $&#123;&#123; env.RUST_CHANNEL &#125;&#125; rustfmt rust-src</span></span><br><span class=\"line\"><span class=\"string\">          rustup default $&#123;&#123; env.RUST_CHANNEL &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\">      <span class=\"comment\"># Before publishing check warnings and errors</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Publishing</span> <span class=\"string\">check</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">cargo</span> <span class=\"string\">publish</span> <span class=\"string\">--dry-run</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># Publish to crates.io</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Publish</span> <span class=\"string\">to</span> <span class=\"string\">crates.io</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">cargo</span> <span class=\"string\">publish</span> <span class=\"string\">--token</span> <span class=\"string\">$&#123;CRATES_TOKEN&#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../images/rust-test/image-20250127184645648.png\" alt=\"image-20250127184645648\"></p>\n<p>è¿™å°±æ˜¯æ²¡æœ‰æ ¡éªŒé‚®ç®±ä¼šæŠ¥çš„é”™è¯¯ï¼ŒéªŒè¯åæ‰‹åŠ¨ re-run ciã€‚</p>\n<p><img src=\"/../images/rust-test/image-20250127185547066.png\" alt=\"image-20250127185547066\"></p>\n<p>ci æˆåŠŸï¼Œæˆ‘ä»¬å» crates.io ä¸ŠæŸ¥æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰å¯¹åº”çš„åŒ…ï¼Œæœç´¢ package_name åŒ…åã€‚</p>\n<p><img src=\"/../images/rust-test/image-20250127185729124.png\" alt=\"image-20250127185729124\"></p>\n<p><img src=\"/../images/rust-test/image-20250127185713012.png\" alt=\"image-20250127185713012\"></p>\n<p>æˆåŠŸæœåˆ°ï¼Œå®Œæˆ âœ…</p>\n<p>ï¼ˆTODOï¼šåç»­è¿˜å¯ä»¥æŒ‰éœ€åŠ ä¸Š version bumping, git tagging ç­‰åŠŸèƒ½ï¼‰</p>\n","text":"Unit Testå•å…ƒæµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373...","permalink":"/post/rust-test","photos":[],"count_time":{"symbolsCount":"6.1k","symbolsTime":"6 mins."},"categories":[],"tags":[{"name":"rust","slug":"rust","count":13,"path":"api/tags/rust.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Unit-Test\"><span class=\"toc-text\">Unit Test</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Integration-Test\"><span class=\"toc-text\">Integration Test</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#cargo-test\"><span class=\"toc-text\">cargo test</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Doc-Tests\"><span class=\"toc-text\">Doc Tests</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Benches-unstable-TODO\"><span class=\"toc-text\">Benches [unstable __ TODO]</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Examples\"><span class=\"toc-text\">Examples</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#cfg-test\"><span class=\"toc-text\">#[cfg(test)]</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Engineering-Spec-%E5%B7%A5%E7%A8%8B%E8%A7%84%E8%8C%83\"><span class=\"toc-text\">Engineering Spec å·¥ç¨‹è§„èŒƒ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BB%83%E4%B9%A0\"><span class=\"toc-text\">ç»ƒä¹ </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE-github\"><span class=\"toc-text\">é…ç½® github</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Puiblishing-on-crates-io\"><span class=\"toc-text\">Puiblishing on crates.io</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Publish-a-crate\"><span class=\"toc-text\">Publish a crate</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Packaging-a-crate\"><span class=\"toc-text\">Packaging a crate</span></a></li></ol></li></ol>","author":{"name":"Marnie","slug":"blog-author","avatar":"/images/favicon.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"å¹¶å‘ Concurrency","uid":"d644caf05d644047d4c92cde0f070d6e","slug":"concurrency","date":"2025-01-28T13:38:22.000Z","updated":"2025-02-13T21:07:16.352Z","comments":true,"path":"api/articles/concurrency.json","keywords":"","cover":[],"text":"Concurrency in Ruståœ¨ Rust ä¸­ï¼Œå¹¶å‘ï¼ˆConcurrencyï¼‰æ˜¯ä¸€é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œæ—¨åœ¨å®‰å…¨é«˜æ•ˆçš„åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚ Spawning Thr...","permalink":"/post/concurrency","photos":[],"count_time":{"symbolsCount":"18k","symbolsTime":"17 mins."},"categories":[],"tags":[{"name":"rust","slug":"rust","count":13,"path":"api/tags/rust.json"}],"author":{"name":"Marnie","slug":"blog-author","avatar":"/images/favicon.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"è¿­ä»£å™¨ Iterators","uid":"dffe4aa96c5d22cd6989d498cd57fa66","slug":"iterators","date":"2025-01-21T10:15:44.000Z","updated":"2025-01-26T15:38:43.838Z","comments":true,"path":"api/articles/iterators.json","keywords":"","cover":[],"text":"What are iterators?è¿­ä»£å™¨æ˜¯ Rust ä¸­ç”¨æ¥å¤„ç†é›†åˆçš„æ–¹å¼ï¼Œå…è®¸éå†å’Œæ“ä½œåºåˆ—å€¼ã€‚ Iterator TraitIterator Trait...","permalink":"/post/iterators","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"rust","slug":"rust","count":13,"path":"api/tags/rust.json"}],"author":{"name":"Marnie","slug":"blog-author","avatar":"/images/favicon.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}