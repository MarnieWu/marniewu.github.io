{"title":"spl-token-contract","uid":"4b5a0f639775a39c3a751526b5f7688f","slug":"spl-token-contract","date":"2025-03-15T03:25:30.000Z","updated":"2025-03-28T12:44:30.236Z","comments":true,"path":"api/articles/spl-token-contract.json","keywords":"","cover":[],"content":"<h2 id=\"Solana-SPL-Token-合约简单实现\"><a href=\"#Solana-SPL-Token-合约简单实现\" class=\"headerlink\" title=\"Solana SPL Token 合约简单实现\"></a>Solana SPL Token 合约简单实现</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>可参考官方实战案例：<a href=\"https://solana.com/developers/courses/native-onchain-development/program-state-management\">https://solana.com/developers/courses/native-onchain-development/program-state-management</a></p></blockquote>\n<h3 id=\"Solana-项目结构\"><a href=\"#Solana-项目结构\" class=\"headerlink\" title=\"Solana 项目结构\"></a>Solana 项目结构</h3><p><strong>核心文件</strong></p>\n<ul>\n<li>processor.rs：核心业务逻辑，处理指令。</li>\n<li>state.rs：定义账户的状态和拓展字段。</li>\n<li>instruction.rs：定义各种代币操作的指令。</li>\n<li>error.rs：定义了程序可能抛出的错误。</li>\n<li>lib.rs：程序入口点，汇总各个模块。</li>\n</ul>\n<h3 id=\"涉及账户\"><a href=\"#涉及账户\" class=\"headerlink\" title=\"涉及账户\"></a>涉及账户</h3><p>在Solana的账户体系中，账户主要分为三大类：<strong>原生账户</strong>、<strong>程序账户</strong> 和 <strong>数据账户</strong></p>\n<ul>\n<li>程序账户：是用于存储可执行的程序，简单来说就是一些指令，负责处理交易过程中的一些逻辑。</li>\n<li>数据账户：是用于存储账户数据的，简单来说就是原本链上都是 stateless 的，如果需要数据管理就对应创建一个账户用来存储数据。</li>\n<li>原生账户：由 Solana Labs 内部提供的<strong>所属于系统的账户</strong>，用于提供 Solana 网络的核心功能如<strong>创建账户</strong>、<strong>分配空间</strong>、<strong>分配所有权</strong>等。</li>\n</ul>\n<p>一般 xxx_program 则表示 <strong>某某程序账户</strong> 或 <strong>系统账户</strong>，xxx_account 则表示 <strong>某某数据账户</strong>。每个数据账户都有一个 <strong>owner</strong> 字段，表示属于哪个程序账户所有，<strong>只有 owner 字段的账户才有权修改数据账户的数据</strong>。</p>\n<p><strong>常用非数据账户：</strong></p>\n<ul>\n<li>System Program：<ul>\n<li>原生账户，<strong>创建账户</strong>、<strong>分配空间</strong>、<strong>分配所有权</strong>等操作。</li>\n<li>分配所有权是指当系统账户创建出新账户后，原本属于系统账户所有，可以修改它的所有者为其他账户。</li>\n<li>所有 钱包账户 的 owner 都为原生账户，所以系统账户才能对钱包账号进行转账操作。</li>\n</ul>\n</li>\n<li>Token Program：<ul>\n<li>SPL（Solana Program Library） 提供的用于管理 Mint Account 和 Token Account 的一个<strong>程序账户</strong>。</li>\n<li><strong>Token Program 是 Token Account 的 owner</strong>。</li>\n</ul>\n</li>\n<li>Associated Token Program：<ul>\n<li>用于追踪 ATA 和 钱包地址关联的<strong>程序账户</strong>。</li>\n<li><strong>ATA 的 owner 是 Associated Token Program</strong>。</li>\n</ul>\n</li>\n</ul>\n<p><strong>常用数据账户：</strong></p>\n<ul>\n<li>Rent Account：<ul>\n<li>属于 Sysvar Accounts 中的一类，本质上是一个<strong>数据账户</strong>，用于存储和 Rent 相关的数据信息。</li>\n<li><strong>Rent Account 的 owner 为 System Program</strong>。</li>\n</ul>\n</li>\n<li>Mint Accout：<ul>\n<li>存储某个代币元数据的账户。</li>\n<li><strong>owner 为 创建代币 的 program ID</strong>。</li>\n</ul>\n</li>\n<li>Associated Token Account：<ul>\n<li>属于 Token Account 中的一种，用于管理 某个钱包地址 和 某个 Mint 之间的关联数据。</li>\n<li><strong>owner 为 SPL 提供的 Associated Token Program</strong>。</li>\n</ul>\n</li>\n<li>Wallet Account：<ul>\n<li>某个钱包，交易使用其公钥地址。</li>\n<li><strong>owner 为 System Program</strong>。</li>\n</ul>\n</li>\n</ul>\n<p>在 Solana 区块链上，创建一个 mint账户（铸币账户）并分发给某个钱包账户会有以下步骤：</p>\n<ul>\n<li>创建铸币账户<strong>（Mint Account）</strong>，用于创建某个新代币，铸币账户存储代币相关的元数据，如发行量等。</li>\n<li>创建代币账户<strong>（Token Account）</strong>，代币账户是某个个体所持有某个代币数量及所有权的账户。</li>\n<li>分发代币（<strong>Mint Tokens</strong>），将某个铸币账户和某个代币账户进行关联，并更新铸币账户的发行量、代币账户的持有量等。</li>\n</ul>\n<p><strong>官方给出的关系图</strong></p>\n<p><img src=\"https://solana.com/assets/docs/core/tokens/token-account-relationship.svg\" alt=\"Account Relationship\"></p>\n<h3 id=\"client-端（Rust）\"><a href=\"#client-端（Rust）\" class=\"headerlink\" title=\"client 端（Rust）\"></a>client 端（Rust）</h3><ul>\n<li>rpc_client：创建 RPC 客户端，建立和区块链网络通信的桥梁</li>\n<li>read_keypair_file: 获取本地 wallet address</li>\n<li></li>\n</ul>\n<h3 id=\"合约端（Rust）\"><a href=\"#合约端（Rust）\" class=\"headerlink\" title=\"合约端（Rust）\"></a>合约端（Rust）</h3><ul>\n<li>solana_program::system_instruction::create_account</li>\n</ul>\n<p>在Solana区块链上，创建一个mint账户（铸币账户）涉及到多个关键账户。以下是每个账户的作用：</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"创建-Mint-Account\"><a href=\"#创建-Mint-Account\" class=\"headerlink\" title=\"创建 Mint Account\"></a>创建 Mint Account</h4><p><strong>相关账户</strong></p>\n<ol>\n<li>mint_account: 铸币账户</li>\n<li></li>\n</ol>\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"创建-Token-Account\"><a href=\"#创建-Token-Account\" class=\"headerlink\" title=\"创建 Token Account\"></a>创建 Token Account</h4><p><strong>相关账户’</strong></p>\n<ol>\n<li>mint_account：关联的铸币账户</li>\n<li>associated_token_account: ATA 账户</li>\n</ol>\n","text":"Solana SPL Token 合约简单实现 可参考官方实战案例：https://solana.com/developers/courses/native-o...","permalink":"/post/spl-token-contract","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"solana","slug":"solana","count":7,"path":"api/tags/solana.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Solana-SPL-Token-%E5%90%88%E7%BA%A6%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">Solana SPL Token 合约简单实现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Solana-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">Solana 项目结构</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B6%89%E5%8F%8A%E8%B4%A6%E6%88%B7\"><span class=\"toc-text\">涉及账户</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#client-%E7%AB%AF%EF%BC%88Rust%EF%BC%89\"><span class=\"toc-text\">client 端（Rust）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%88%E7%BA%A6%E7%AB%AF%EF%BC%88Rust%EF%BC%89\"><span class=\"toc-text\">合约端（Rust）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\"><span class=\"toc-text\"></span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA-Mint-Account\"><span class=\"toc-text\">创建 Mint Account</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#-1\"><span class=\"toc-text\"></span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA-Token-Account\"><span class=\"toc-text\">创建 Token Account</span></a></li></ol></li></ol></li></ol>","author":{"name":"Marnie","slug":"blog-author","avatar":"/images/favicon.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"create-basic-program","uid":"6aaea4836c6acb6130648711cb680200","slug":"create-basic-program","date":"2025-03-20T05:42:13.000Z","updated":"2025-03-25T08:18:55.919Z","comments":true,"path":"api/articles/create-basic-program.json","keywords":"","cover":null,"text":"Create A Basic Program 分别创建 dApp端（client端）和 合约端 目录 12cargo new clientcargo new p...","permalink":"/post/create-basic-program","photos":[],"count_time":{"symbolsCount":"5.6k","symbolsTime":"5 mins."},"categories":[],"tags":[{"name":"solana","slug":"solana","count":7,"path":"api/tags/solana.json"}],"author":{"name":"Marnie","slug":"blog-author","avatar":"/images/favicon.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"solana-token","uid":"862a15ca9d7f5ce192b03b7aed288867","slug":"solana-token","date":"2025-03-14T05:09:58.000Z","updated":"2025-03-27T11:19:34.452Z","comments":true,"path":"api/articles/solana-token.json","keywords":"","cover":[],"text":"Solana 上的代币代币是代表对各种资产所有权的数字资产。代币化使得财产权的数字化成为可能，是管理「可替代和不可替代资产」的基本组成部分。 可替代代币代表同类...","permalink":"/post/solana-token","photos":[],"count_time":{"symbolsCount":"3.6k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"solana","slug":"solana","count":7,"path":"api/tags/solana.json"}],"author":{"name":"Marnie","slug":"blog-author","avatar":"/images/favicon.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}